name: Runner Availability Check

on:
  workflow_dispatch:

permissions:
  actions: read
  issues: write

jobs:
  check:
    runs-on: [self-hosted]
    steps:
      - name: Check self-hosted runners for this repo
        uses: actions/github-script@d7906e4ad0b1822421a7e6a35d5ca353c962f410
        with:
          script: |
            const resp = await github.rest.actions.listSelfHostedRunnersForRepo({ owner: context.repo.owner, repo: context.repo.repo });
            const runners = resp.data.runners || [];
            const online = runners.filter(r => r.status === 'online');
            core.info(`Total runners: ${runners.length}, online: ${online.length}`);
            if (online.length === 0) {
              await github.rest.issues.createComment({ owner: context.repo.owner, repo: context.repo.repo, issue_number: 280, body: `No self-hosted runners online as of ${new Date().toISOString()}.` });
            }
