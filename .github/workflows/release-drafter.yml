name: Release Drafter
true:
  push:
    branches:
    - main
  pull_request:
    types:
    - opened
    - reopened
    - synchronize
    - labeled
    - unlabeled
    - edited
permissions:
  contents: write
  pull-requests: read
jobs:
  credit_check:
    uses: ./.github/workflows/actions-credit-guard-enhanced.yml
    with:
      estimated_minutes: 10
      threshold_percent: 3
      force_local: true
      fallback_runner: '["self-hosted","docker-swarm"]'
      slack_webhook: ${{ secrets.SLACK_WEBHOOK_URL }}
  update_release_draft:
    if: ${{ github.event_name != 'pull_request' || contains(toJson(github.event.pull_request.labels),
      'ci:full') }}
    runs-on: ${{ fromJson(needs.credit_check.outputs.runner) }}
    steps:
    - name: Release Drafter
      uses: release-drafter/release-drafter@6db134d15f3909ccc9eefd369f02bd1e9cffdf97
      with:
        config-name: release-drafter.yml
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    needs:
    - credit_check
